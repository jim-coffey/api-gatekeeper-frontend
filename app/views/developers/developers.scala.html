@import controllers._
@import model._
@import include._

@(users: PageableCollection[User],
  emails: String,
  apis: Map[APIStatus.APIStatus, Seq[VersionSummary]],
  filter: Option[String],
  status: Option[String])(implicit request: Request[_], userFullName: Option[String], messages: Messages)

@main(title = "API Gatekeeper Dashboard",userFullName = userFullName) {

<article class="content__body full-width">
    <header>
        <h1>Dashboard</h1>
    </header>

    @tabList(activeTab = 1)

    <form name="developer-filters"
          action="@routes.DevelopersController.developersPage(filter, status, Some(users.pageNumber), Some(users.pageSize)).url"
          method="get">

        <div class="grid-layout grid-layout--stacked push--sides">

            <div class="grid-layout__column--1-3">
                <label class="bold centered-content hard--left">
                    <span class="label__text bold">Search</span>
                    <input class="form-control-7-8 input--cleared input-select--large"
                        data-datatable-filter="developer-table"
                        name="example"
                        type="text"
                        placeholder="Name, Email, Application" />
                </label>
            </div>

            <div class="grid-layout__column--1-3 grid-wrapper">
                @defining(ApiFilter(filter)) { apiFilter =>
                    <label class="form-label bold" for="filter">Filter by API Subscription
                        <select class="form-control input-select input-select--large"
                                data-datatable-filter="developer-table"
                                multiple="multiple"
                                id="filter"
                                name="filter"
                                placeholder="All Users"
                                value="">

                            <!--<option @if(apiFilter == AllUsers) {selected} value>All users</option>-->
                            <option @if(apiFilter == OneOrMoreSubscriptions) {selected} value="ANYSUB">One or more subscriptions</option>
                            <option @if(apiFilter == NoSubscriptions) {selected} value="NOSUB">No subscriptions</option>
                            <option @if(apiFilter == OneOrMoreApplications) {selected} value="ANYAPP">One or more applications</option>
                            <option @if(apiFilter == NoApplications) {selected} value="NOAPP">No applications</option>

                            @for((status, versions) <- apis) {
                                <optgroup label="@status">
                                    @for(version <- versions.sortBy(v => v.name.toLowerCase)) {
                                        <option @if(apiFilter == Value(version.apiIdentifier.context)) {selected}
                                                value="@version.apiIdentifier.context">@version.name (@version.apiIdentifier.version)</option>
                                    }
                                </optgroup>
                            }
                        </select>
                    </label>
                }
            </div>

            <div class="grid-layout__column--1-3 grid-wrapper">
                <label class="form-label bold centered-content right" for="status">Filter by Status
                    <select class="form-control input-select input-select--large"
                            data-datatable-filter="developer-table"
                            data-datatable-column-filter="3"
                            id="status"
                            name="status"
                            value="@status">
                        @for((value,label) <- Map("" -> "All", "VERIFIED" -> "Verified", "UNVERIFIED" -> "Not yet verified", "UNREGISTERED" -> "Not registered")) {
                            <option value="@value" @if(Some(value) == status){selected}>@label</option>
                        }
                    </select>
                </label>
            </div>

            <div class="float-right js-hidden">
                <input type="submit" value="Submit" name="main-submit" class="button text--center flush--right" />
            </div>
        </div>

        <div id="filter-word-cloud" class="word-cloud">
            <div class="word-tag word-tag--blue">
                <div class="word-tag__left"></div>
                <div class="word-tag__label">
                    API Documentation Test (0.4)
                </div>
                <div class="word-tag__close">&times;</div>
            </div>
            <div class="word-tag word-tag--blue">
                <div class="word-tag__left"></div>
                <div class="word-tag__label">Hello World (1.0)</div>
                <div class="word-tag__close">&times;</div>
            </div>
            <div class="word-tag word-tag--orange">
                <div class="word-tag__left"></div>
                <div class="word-tag__label">API Documentation Test (0.4)</div>
                <div class="word-tag__close">&times;</div>
            </div>
            <div class="word-tag word-tag--orange">
                <div class="word-tag__left"></div>
                <div class="word-tag__label">Hello World (1.0)</div>
                <div class="word-tag__close">&times;</div>
            </div>
            <div class="word-tag word-tag--green">
                <div class="word-tag__left"></div>
                <div class="word-tag__label">Hello World (1.0)</div>
                <div class="word-tag__close">&times;</div>
            </div>
            <div class="word-tag word-tag--green">
                <div class="word-tag__left"></div>
                <div class="word-tag__label">API Documentation Test (0.4)</div>
                <div class="word-tag__close">&times;</div>
            </div>
            <div class="word-tag word-tag--grey">
                <div class="word-tag__left"></div>
                <div class="word-tag__label">Hello World (1.0)</div>
                <div class="word-tag__close">&times;</div>
            </div>
            <div class="word-tag word-tag--grey">
                <div class="word-tag__left"></div>
                <div class="word-tag__label">Hello World (1.0)</div>
                <div class="word-tag__close">&times;</div>
            </div>
        </div>

        <table id="developer-table"
            class="dataTable no-footer developer-list"
            width="100%"
            data-dom="t<'text--center'lip>"
            data-order='[0,"asc"]'
            data-page-length="10"
            data-paginate="true"
            data-length-change="true"
            data-length-menu="[10,50,100]"
            data-responsive="true"
            data-column-defs='[{"targets": [0,1,2], "orderable": true}, {"targets": [4], "visible": false, "searchable": true}]'
            data-language='{"sSearchPlaceholder":"Email, Name, Application","sSearch":"<span class=\"full-width shim text--left\"><strong>Search</strong></span>"}'>
            <thead>
                <tr role="row">
                    <th tabindex="0" class="sorting_left-aligned">Email</th>
                    <th tabindex="0" class="sorting_left-aligned">First name</th>
                    <th tabindex="0" class="sorting_left-aligned">Last name</th>
                    <th class="text--right hard--right" tabindex="0" data-orderable="false" data-search="false">Status</th>
                    <th class="text--right hard--right" data-orderable="false" tabindex="0">Subscriptions</th>
                </tr>
            </thead>
            <tbody>
            @for((developer, index) <- users.projection.zipWithIndex) {
                <tr role="row">
                    <td id="dev-email-@index">@developer.email</td>
                    <td id="dev-fn-@index">@developer.firstName</td>
                    <td id="dev-sn-@index">@developer.lastName</td>
                    <td class="text--right hard--right" id="dev-status-@index">
                        @defining(developer.status match {
                        case VerifiedStatus => ("status status--verified", "verified")
                        case UnverifiedStatus => ("status status--not-verified", "not yet verified")
                        case UnregisteredStatus => ("status status--not-verified", "not registered")
                        }) { case(cssStyle, text) => <span class="@cssStyle">@text</span> }
                    </td>
                    <td id="dev-sub-@index" class="text--right hard--right">api-documentation-test-service</td>
                </tr>
            }
            </tbody>
        </table>

        <div class="js-hidden grid-layout grid-layout--stacked" style="margin-left:0">
            <div class="grid-layout__column--1-3 filters">
                <div class="dataTables_info" id="DataTables_Table_0_info" role="status" aria-live="polite">
                    <label class="label--inlineDropDown">Show rows:
                        <select class="select perpage" id="pageSize" name="pageSize"
                        value="@users.pageSize">
                        @for(n <- List(10,50,100,200,300)) {
                            <option value="@n" @if(users.pageSize == n){selected}>@n</option>
                        }
                        </select>
                    </label>
                    <input type="submit" value="Go" class="button text--center flush--right" />
                </div>
            </div>

            <div class="grid-layout__column--1-3 text--center">
                @entry(users,"No developers for your selected filter")
            </div>

            <div class="grid-layout__column--1-3">
                <div class="dataTables_paginate paging_simple" id="DataTables_Table_0_paginate">
                    @paginateButton("Previous", "paginate_button previous", users, filter, status, -1)
                    @paginateButton("Next", "paginate_button next", users, filter, status, 1)
                </div>
            </div>
        </div>
    </form>

    @if(users.length > 0) {
        <div class="form-group>">
            <p>
                <a id="copy-to-clip" class="button" href="#" title="Copies all @{users.length} email addresses into the system clipboard." data-clip-text="@emails">Copy to clipboard</a>
            </p>
        </div>
    }
    <div class="form-group>">
        <a class="back-to-top-link" href="#">Back to Top</a>
    </div>
</article>
}

@paginateButton(text: String, cssClass: String, content: model.PageableCollection[_], filter: Option[String], status: Option[String], direction: Int) = {
    @if(direction < 0 && content.hasPrevious || direction > 0 && content.hasNext) {
        <a class="@cssClass"
           rel="@if(direction < 0) {prev} else {next}"
           href="@routes.DevelopersController.developersPage(filter, status, Some(content.pageNumber + direction), Some(content.pageSize))"
            aria-controls="DataTables_Table_0"
            data-dt-idx="@if(direction < 0) {0} else {1}"
            id="DataTables_Table_0_@if(direction < 0) {prev} else {next}"
        >@text</a>
    }

}
